!function(e){var n={};function t(r){if(n[r])return n[r].exports;var u=n[r]={i:r,l:!1,exports:{}};return e[r].call(u.exports,u,u.exports,t),u.l=!0,u.exports}t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var u in e)t.d(r,u,function(n){return e[n]}.bind(null,u));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=14)}([function(e,n){e.exports=require("passport")},function(e,n,t){"use strict";"\nCREATE TABLE IF NOT EXISTS ".concat("users"," (\n    id SERIAL,\n    username text PRIMARY KEY,\n    password text NOT NULL,\n    role text NOT NULL\n);");var r="SELECT * FROM ".concat("users"," WHERE username = $1;"),u="INSERT INTO ".concat("users"," (username, password, role) VALUES ($1, $2, $3);"),o=("UPDATE ".concat("users"," SET password = $2 WHERE username = $1;"),"DELETE FROM ".concat("users"," WHERE username = $1;"),t(12)),s=process.env.DATABASE_URL||"postgresql://localhost",a=new o.Client(s);a.connect().then(function(){console.log("Connected to database...")}).catch(function(e){console.error("CONNECTION ERROR: ",e.stack)});var c=a;t.d(n,"a",function(){return i}),t.d(n,"b",function(){return f});var i=function(e,n,t){return new Promise(function(r,o){c.query(u,[e,n,t]).then(function(){return r(!0)}).catch(function(e){return o(e)})})},f=function(e){return new Promise(function(n,t){c.query(r,[e]).then(function(e){return e.rows.length>0?n(e.rows[0]):n(void 0)}).catch(function(e){return t(e)})})}},function(e,n){e.exports=require("bcrypt")},function(e,n){e.exports=require("express")},function(e,n,t){"use strict";t.r(n);var r=t(0),u=t.n(r),o=t(11),s=t(5),a=t(2),c=t.n(a),i=t(1),f={jwtFromRequest:s.ExtractJwt.fromAuthHeaderWithScheme("jwt"),secretOrKey:"aSecret"},l=new s.Strategy(f,function(e,n){return Object(i.b)(e.username).then(function(e){return n(null,e||!1)}).catch(function(e){n(e,!1)})}),d=new o.Strategy({passwordField:"password",usernameField:"username"},function(e,n,t){Object(i.b)(e).then(function(e){if(null==e)return t(null,!1,{error:"Login failed. Please try again."});c.a.compare(n,e.password).then(function(n){return n?t(null,e):t(null,!1,{error:"Login failed. Please try again."})}).catch(function(){return t(null,!1,{error:"Login failed. Please try again."})})}).catch(function(){return t(null,!1,{error:"Login failed. Please try again."})})});u.a.use(l),u.a.use(d),n.default=u.a},function(e,n){e.exports=require("passport-jwt")},function(e,n){e.exports=require("body-parser")},function(e,n){e.exports=require("jsonwebtoken")},function(e,n){e.exports=require("fs")},function(e,n){e.exports=require("cors")},function(e,n){e.exports=require("morgan")},function(e,n){e.exports=require("passport-local")},function(e,n){e.exports=require("pg")},function(e,n){e.exports=require("http")},function(e,n,t){"use strict";t.r(n);var r=t(13),u=t(1),o=t(7),s=t.n(o),a=t(8),c=t.n(a),i=function(e){c.a.readFileSync("./private.key","utf8");return s.a.sign(e,"aSecret",{expiresIn:10080})},f=function(e,n){return{data:n,message:null,status:"SUCCESS",statusCode:e}},l=function(e,n){return{data:null,message:n,status:"FAIL",statusCode:e}},d=function(e,n){return{data:null,message:n,status:"ERROR",statusCode:e}},p=function(e){return{token:"JWT "+i(e),user:e}},g=function(e){return"Missing required field: ".concat(e)},h=function(e,n,t){return"Can't find ".concat(e," with ").concat(n,": ").concat(t)},m=t(2),E=t.n(m),b=t(3),y=t.n(b),S=t(0),v=t.n(S),x=y.a.Router(),O=(t(4),v.a.authenticate("jwt",{session:!1})),w=v.a.authenticate("local",{session:!1});x.post("/register",function(e,n){var t=e.body.username,r=e.body.password,o=e.body.role;return null==t?n.status(400).send(l(400,g("username"))):null==r?n.status(400).send(l(400,g("password"))):null==o?n.status(400).send(l(400,g("role"))):void Object(u.b)(t).then(function(e){if(void 0!==e)return n.status(404).send(l(404,h("user","username",t)));E.a.genSalt(10).then(function(e){E.a.hash(r,e).then(function(e){Object(u.a)(t,e,"USER").then(function(){return n.status(200).send(f(200,p({role:o,username:t})))}).catch(function(e){return n.status(500).send(d(500,"Error in createUser: "))})}).catch(function(e){return n.status(500).send(d(500,"Error in generation of hash: "))})}).catch(function(e){return n.status(500).send(d(500,"Error in generation of salt: "))})}).catch(function(e){return n.status(500).send(d(500,"Error in getUserByUsername: "))})}),x.post("/login",w,function(e,n){var t=e.user.username,r=e.user.role;n.status(200).send(f(200,p({role:r,username:t})))}),x.get("/user",O,function(e,n){return n.status(200).send({role:e.user.role,username:e.user.username})});var R=x,j=t(6),T=t.n(j),q=t(9),L=t.n(q),P=t(10),C=t.n(P),A=t(4),N=y()();N.use(L()()),N.use(C()("dev")),N.use(T.a.json()),N.use(T.a.urlencoded({extended:!0})),N.use(A.default.initialize()),N.use(A.default.session()),N.use("/auth",R);var U=Object(r.Server)(N),I=process.env.PORT||8080;U.listen(I,function(){console.log("Starting src on port "+I)})}]);